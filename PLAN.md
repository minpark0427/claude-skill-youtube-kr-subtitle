# YouTube 한글 자막 자동 삽입 서비스

## 프로젝트 개요
YouTube 영상 링크를 입력받아 한글 자막이 하드코딩된 새로운 영상을 자동으로 생성하는 서비스

## 핵심 기능

### 1. 영상 다운로드
- **입력**: YouTube URL
- **도구**: `yt-dlp`
- **출력**: 원본 영상 파일 (mp4)
- **고려사항**:
  - 다양한 해상도 지원 (1080p, 720p, 480p)
  - 저작권 보호 콘텐츠 처리
  - 다운로드 실패 시 재시도 로직

### 2. 자막 획득
두 가지 방식 지원:

#### 방식 A: 기존 자막 활용
- YouTube에 이미 업로드된 자막(영어, 기타 언어) 다운로드
- `yt-dlp --write-auto-sub` 또는 `--write-sub` 사용
- 자막 형식: SRT, VTT

#### 방식 B: 음성 인식 (STT)
- 자막이 없는 경우 오디오에서 직접 추출
- **도구**: OpenAI Whisper 또는 Google Cloud Speech-to-Text
- **장점**: 모든 영상에 적용 가능
- **단점**: 처리 시간 증가, API 비용

### 3. 한글 번역
- **입력**: 원본 자막 (영어 또는 기타 언어)
- **번역 옵션**:
  1. OpenAI GPT API (고품질, 문맥 이해)
  2. Google Translate API (빠름, 저렴)
  3. DeepL API (자연스러운 번역)
  4. Anthropic Claude API (긴 문맥 처리 우수)
- **출력**: 한글 자막 파일 (SRT)
- **최적화**:
  - 배치 처리로 API 호출 최소화
  - 타임스탬프 정확도 유지
  - 문장 길이 조절 (화면 가독성)

### 4. 자막 삽입 (Hard-coding)
- **도구**: FFmpeg
- **방식**: 자막을 영상에 직접 렌더링 (burn-in subtitle)
- **커스터마이징**:
  - 폰트: 나눔고딕, 본고딕 등 한글 폰트
  - 위치: 하단 중앙
  - 스타일: 배경색, 테두리, 크기
  - 가독성: 검은 배경 + 흰 글씨 또는 테두리 효과
- **명령어 예시**:
  ```bash
  ffmpeg -i video.mp4 -vf "subtitles=subtitle_ko.srt:force_style='FontName=NanumGothic,FontSize=20,PrimaryColour=&HFFFFFF,OutlineColour=&H000000,Outline=2'" output.mp4
  ```

### 5. 결과물 제공
- **출력**: 한글 자막이 삽입된 새로운 영상 파일
- **메타데이터**: 원본 제목, 처리 일시
- **저장 옵션**:
  - 로컬 저장
  - 클라우드 스토리지 업로드 (S3, Google Drive)
  - 다운로드 링크 생성

## 기술 스택

### Backend
- **언어**: Python 3.10+
- **프레임워크**: FastAPI (REST API) 또는 Flask
- **비동기 처리**: Celery + Redis (긴 작업 처리)

### 핵심 라이브러리
- `yt-dlp`: YouTube 다운로더
- `ffmpeg-python`: 영상 처리
- `openai-whisper`: 음성 인식 (선택)
- `openai` / `google-cloud-translate`: 번역
- `pysrt` 또는 `webvtt-py`: 자막 파싱

### 인프라
- **개발 환경**: Docker
- **배포**: AWS EC2 / Google Cloud Run
- **스토리지**: AWS S3 / Google Cloud Storage
- **큐**: Redis (작업 큐 관리)

## 아키텍처

```
[사용자]
   ↓ YouTube URL 입력
[API Server] (FastAPI)
   ↓ 작업 생성
[Task Queue] (Celery + Redis)
   ↓
[Worker 1] → YouTube 다운로드
   ↓
[Worker 2] → 자막 추출/생성 → 번역
   ↓
[Worker 3] → FFmpeg 자막 삽입
   ↓
[Storage] → 결과물 저장
   ↓
[사용자] ← 다운로드 링크 전달
```

## 워크플로우

1. **사용자 입력**
   - YouTube URL 제공
   - 선택 옵션: 해상도, 자막 언어, 폰트 스타일

2. **검증**
   - URL 유효성 확인
   - 영상 접근 가능 여부 확인
   - 예상 처리 시간 계산

3. **다운로드** (1-5분)
   - 영상 + 오디오 다운로드
   - 기존 자막 확인 및 다운로드

4. **자막 처리** (2-10분)
   - 자막이 있으면: 바로 번역
   - 자막이 없으면: Whisper로 음성 인식 → 번역

5. **영상 생성** (5-15분)
   - FFmpeg로 자막 삽입
   - 인코딩 및 최적화

6. **결과 제공**
   - 다운로드 링크 생성
   - 이메일/알림 발송 (선택)

## 예상 처리 시간
- 10분 영상 기준:
  - 다운로드: 1-2분
  - 자막 추출/STT: 2-5분
  - 번역: 1-2분
  - 인코딩: 5-10분
  - **총 소요시간**: 10-20분

## 비용 예상 (영상당)

### API 비용
- Whisper API: $0.006/분 → 10분 영상 $0.06
- GPT-4 번역: ~$0.03-0.10 (자막 길이 의존)
- Google Translate: $20/100만자 → ~$0.01

### 인프라 비용
- AWS EC2 t3.medium: $0.0416/시간
- S3 스토리지: $0.023/GB/월
- 영상 1개당 총 비용: **$0.10-0.20**

## 확장 기능 (Phase 2)

1. **다국어 지원**
   - 한글 외 다른 언어로도 번역
   - 여러 자막 트랙 동시 생성

2. **UI 개선**
   - 웹 인터페이스 (React/Next.js)
   - 진행 상황 실시간 표시
   - 미리보기 기능

3. **자막 스타일 커스터마이징**
   - 사용자 정의 폰트, 색상, 위치
   - 템플릿 제공

4. **일괄 처리**
   - 여러 영상 동시 처리
   - 플레이리스트 전체 처리

5. **품질 개선**
   - 전문 번역가 검수 옵션
   - AI 음성 더빙 (TTS)

## 제약사항 및 고려사항

### 법적 이슈
- YouTube 이용약관 준수
- 저작권 보호 콘텐츠 처리
- 개인적 사용 vs 상업적 사용 구분

### 기술적 제약
- 대용량 영상 처리 시 서버 리소스
- 동시 처리 작업 수 제한
- 스토리지 용량 관리

### 품질 관리
- 번역 품질 (기계 번역의 한계)
- 타이밍 동기화 정확도
- 자막 가독성

## 구현 우선순위

### MVP (최소 기능 제품)
1. YouTube 영상 다운로드
2. 기존 자막 활용 + Google Translate
3. FFmpeg 자막 삽입 (기본 스타일)
4. 로컬 파일 저장

### Phase 1
1. Whisper STT 통합
2. GPT 번역 옵션 추가
3. 간단한 CLI 인터페이스
4. 클라우드 스토리지 연동

### Phase 2
1. 웹 UI 구축
2. 사용자 계정 및 히스토리
3. 고급 스타일 옵션
4. 일괄 처리

## 다음 단계

1. 개발 환경 설정
   - Python 가상환경 생성
   - 필수 패키지 설치
   - FFmpeg 설치

2. 프로토타입 개발
   - 단일 영상 처리 스크립트
   - 각 단계별 테스트

3. API 설계
   - 엔드포인트 정의
   - 요청/응답 스키마

4. 배포 준비
   - Docker 이미지 생성
   - CI/CD 파이프라인
